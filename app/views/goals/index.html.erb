<div class="container">
  <h1 class="text-center mt-4 mb-4">My Goals</h1>

  <div class="container">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-6">
      <%= form_tag(goals_path, method: :get, class: "simple_form search") do %>
        <div class="search-form-control form-group">
          <div class="input-group">
            <%= text_field_tag(:query, params[:query], class: "form-control", placeholder: 'Search goals...') %>
            <button class="btn btn-flat rounded-end" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

  <% if @goals.empty? %>
    <h5>You haven't setted any goal!</h5>
    <%= link_to "Set your first goal here", new_goal_path, class: "btn btn-success" %>
  <% else %>
    <% if @favorite_array.empty? %>
      <h3 class="text-center"><%= @goals.first.name %></h3>

      <div class="row justify-content-center">
        <div class="col-8 col-sm-6">
          <img src="https://m.media-amazon.com/images/I/716+A9OrcSL._AC_SL1500_.jpg" alt="" class= "img-fluid mx-auto d-block rounded-4" >
        </div>
      </div>

      <div class="shadow">
        <div class="progress mt-4 mb-2" style="height: 30px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: <%= @percentage %>%;" aria-valuenow="<%= @percentage %>" aria-valuemin="0" aria-valuemax="100"><%= @percentage %>%</div>
        </div>
      </div>

      <div class="d-flex justify-content-between">

      <% if current_user.balance < 0 %>
        <p><strong>Saved Amount: </strong><span class="text-danger">€<%= current_user.balance %></span></p>
      <% else %>
        <p><strong>Saved Amount: </strong><span class="text-success">€<%= current_user.balance %></span></p>
      <% end %>
        <p></p><strong><%= @goals.first.name %>'s Price:<strong> <span>$<%= @goals.first.amount %></span></p>
      </div>

      <div class="d-flex justify-content-end mt-3 mb-3">
        <%= link_to "Add Goal", new_goal_path, class: "btn btn-success" %>
      </div>

      <% @goals.each do |goal| %>
      <% percentage = (current_user.balance * 100) / goal.amount %>
      <div class="progress" style="height: 5px; width: 400px;">
        <div class="progress-bar bg-success" role="progressbar" style="width: <%= percentage %>%;" aria-valuenow="<%= percentage %>" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="card-product mb-3 rounded">
        <div>
          <% if goal.photo.attached? %>
            <%= cl_image_tag goal.photo.key %>
          <% else %>
            <img src="https://m.media-amazon.com/images/I/716+A9OrcSL._AC_SL1500_.jpg">
          <% end %>
        </div>
        <div class="d-flex justify-content-between">
          <div class="text-start">
            <p class="fs-8 ms-3 me-3"><%= goal.name %></p>
          </div>
          <div class="text-end">
            <p class="fs-8 me-3">$<%= goal.amount %> <i class="fa-solid fa-circle-info" data-controller="tooltip" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= goal.created_at.strftime('%A, %d %b %Y %l:%M %p') %>"></i></p>
          </div>
        </div>
        <div class="d-flex">
          <%= link_to favorite_goal_path(goal), data: { turbo_method: :patch } do %>
            <% if goal.favorite == false %>
              <i class="fa-regular fa-star me-1 text-dark"></i>
            <% else %>
              <i class="fa-solid fa-star me-1 text-success"></i>
            <% end %>
          <% end %>
          <%= link_to edit_goal_path(goal) do %>
            <%= content_tag(:i, "", class: "fa-solid fa-pen-to-square text-dark me-1") %>
          <% end %>
          <%= link_to goal_path(goal), method: :delete,
              data: { turbo_method: 'DELETE', turbo_confirm: "Delete #{goal.name} Goal?" } do %>
                <%= content_tag(:i, "", class: "fa-solid fa-trash-can text-dark me-2") %>
          <% end %>
        </div>
      </div>
    <% end %>


    <% else %>
      <h3 class="text-center"><%= @favorite_array.first.name %></h3>

      <div class="row justify-content-center">
        <div class="col-8 col-sm-6">
          <% if @favorite_array.first.photo.attached? %>
            <%= cl_image_tag @favorite_array.first.photo.key, class:"img-fluid mx-auto d-block rounded-4"%>
          <% else %>
            <img src="https://m.media-amazon.com/images/I/716+A9OrcSL._AC_SL1500_.jpg" class= "img-fluid mx-auto d-block rounded-4" alt="" style="width: 150px; max-height: 100px;">
          <% end %>
        </div>
      </div>

      <div class="shadow">
        <div class="progress mt-4 mb-2" style="height: 30px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: <%= @percentage %>%;" aria-valuenow="<%= @percentage %>" aria-valuemin="0" aria-valuemax="100"><%= @percentage %>%</div>
        </div>
      </div>
      <div class="d-flex justify-content-between">
        <% if current_user.balance < 0 %>
          <p><strong>Saved Amount: </strong><span class="text-danger">€<%= current_user.balance %></span></p>
        <% else %>
          <p><strong>Saved Amount: </strong><span class="text-success">€<%= current_user.balance %></span></p>
        <% end %>
          <p></p><strong><%= @goals.first.name %>'s Price:<strong> <span class="">$<%= @goals.first.amount %></span></p>
      </div>

      <div class="d-flex justify-content-end mt-3 mb-3">
        <%= link_to "Add Goal", new_goal_path, class: "btn btn-success" %>
      </div>
      <% @goals.each do |goal| %>
        <% percentage = (current_user.balance * 100) / goal.amount %>
        <div class="progress" style="height: 5px; width: 400px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: <%= percentage %>%;" aria-valuenow="<%= percentage %>" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="card-product mb-3 rounded" style="">
          <% if goal.photo.attached? %>
            <%= cl_image_tag goal.photo.key %>
          <% else %>
            <img src="https://m.media-amazon.com/images/I/716+A9OrcSL._AC_SL1500_.jpg">
          <% end %>
          <div class="d-flex justify-content-between">
          <div class="text-start">
            <p class="fs-8 ms-3 me-3"><%= goal.name %></p>
          </div>
          <div class="text-end">
            <p class="fs-8 me-3">$<%= goal.amount %> <i class="fa-solid fa-circle-info" data-controller="tooltip" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= goal.created_at.strftime('%A, %d %b %Y %l:%M %p') %>"></i></p>
          </div>
          </div>
          <div class="d-flex">
            <%= link_to favorite_goal_path(goal), data: { turbo_method: :patch } do %>
              <% if goal.favorite == false %>
                <i class="fa-regular fa-star me-1 text-dark"></i>
              <% else %>
                <i class="fa-solid fa-star me-1 text-success"></i>
              <% end %>
            <% end %>
            <%= link_to edit_goal_path(goal) do %>
              <%= content_tag(:i, "", class: "fa-solid fa-pen-to-square text-dark me-1") %>
            <% end %>
            <%= link_to goal_path(goal), method: :delete,
                data: { turbo_method: 'DELETE', turbo_confirm: "Delete #{goal.name} Goal?" } do %>
                  <%= content_tag(:i, "", class: "fa-solid fa-trash-can text-dark me-2") %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
